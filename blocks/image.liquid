{% doc %}
  Advanced Image Block
{% enddoc %}

{% liquid
  assign image = block.settings.image
  assign ratio_class = block.settings.aspect_ratio
  assign hover_class = block.settings.hover_effect_action

  assign wrapper_classes = 'block-image'

  if hover_class != 'no-effect'
    assign wrapper_classes = wrapper_classes | append: ' ' | append: hover_class
  endif

  assign image_wrapper_classes = ''

  unless ratio_class == 'adapt-to-image'
    assign image_wrapper_classes = 'cropped-image-wrapper ' | append: ratio_class
  endunless

  assign width_style = ''
  if block.settings.enable_custom_width and block.settings.custom_width != blank
    assign width_style = 'max-width:' | append: block.settings.custom_width | append: '%;'
  endif
%}

{% if image != blank %}

  <div
    class="{{ wrapper_classes }}"
    style="
      {{ width_style }}
      text-align: {{ block.settings.alignment }};
    "
    {{ block.shopify_attributes }}
  >

    {% if ratio_class == 'adapt-to-image' %}

      {% render 'image',
        class: 'block-image__media',
        image: image,
        mobile_image: block.settings.image_mobile,
        url: block.settings.link,
        width: image.width,
        height: image.height,
        img_alt: block.settings.alt_text
      %}

    {% else %}

      <div class="{{ image_wrapper_classes }}">

        {% render 'image',
          class: 'block-image__media',
          image: image,
          mobile_image: block.settings.image_mobile,
          url: block.settings.link,
          width: image.width,
          height: image.height,
          img_alt: block.settings.alt_text
        %}

      </div>

    {% endif %}

  </div>

{% endif %}


{% stylesheet %}


.block-image__media {
  max-width: 100%;
}
{% endstylesheet %}

{% schema %}
{
  "name": "Image",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Mobile image"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "alt_text",
      "label": "Alt text"
    },

    {
      "type": "header",
      "content": "Aspect Ratio"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "adapt-to-image",
      "options": [
        { "value": "adapt-to-image", "label": "Adapt to image" },
        { "value": "cropped-image--square", "label": "Square" },
        { "value": "cropped-image--portrait", "label": "Portrait" },
        { "value": "cropped-image--portrait-tall", "label": "Portrait tall" },
        { "value": "cropped-image--landscape", "label": "Landscape" },
        { "value": "cropped-image--wide", "label": "Wide (16:9)" }
      ]
    },

    {
      "type": "header",
      "content": "Hover Effect"
    },
    {
      "type": "select",
      "id": "hover_effect_action",
      "label": "Hover effect",
      "default": "no-effect",
      "options": [
        { "value": "no-effect", "label": "No effect" },
        { "value": "is-hover-zoom-in", "label": "Zoom in" },
        { "value": "is-hover-zoom-out", "label": "Zoom out" },
        { "value": "is-hover-zoom-up", "label": "Zoom up" },
        { "value": "is-hover-fade", "label": "Fade" },
        { "value": "is-hover-cinematic", "label": "Cinematic" },
        { "value": "is-hover-drift", "label": "Drift" },
        { "value": "is-hover-overlay", "label": "Overlay" }
      ]
    },

    {
      "type": "header",
      "content": "Width Control"
    },
    {
      "type": "checkbox",
      "id": "enable_custom_width",
      "label": "Enable custom width",
      "default": false
    },
    {
      "type": "range",
      "id": "custom_width",
      "label": "Width (%)",
      "default": 100,
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "%",
      "visible_if": "{{ block.settings.enable_custom_width }}"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "visible_if": "{{ block.settings.enable_custom_width }}"
    }
  ],
  "presets": [
    { "name": "Image" }
  ]
}

{% endschema %}
