{% doc %}
  Renders flexible columns in a row.
  Mobile supports 1 or 2 columns.

  Use with `column-item` blocks inside to control how much space each
  column takes relative to the others using a span value.
{% enddoc %}

<div 
  class="layout-columns mobile-cols-{{ block.settings.mobile_columns }}"
  style="
    padding: {{ block.settings.padding }}px;
    --gap: {{ block.settings.column_gap }}px;
    --align-items: {{ block.settings.align_items }};
    --justify-content: {{ block.settings.justify_content }};
  "
  {{ block.shopify_attributes }}
>
{% for block in block.blocks %}
  <div 
    class="shopify-block"
    style="--col-span: {{ block.settings.column_span }};"
    {{ block.shopify_attributes }}
  >
    {% render block %}
  </div>
{% endfor %}

</div>

{% style %}
<script>
document.addEventListener('DOMContentLoaded', function () {

  document.querySelectorAll('.layout-columns').forEach(function(container) {

    container.querySelectorAll(':scope > .shopify-block').forEach(function(wrapper) {

      // Find inner element that contains span variable
      const inner = wrapper.querySelector('[style*="--col-span"]');

      if (!inner) return;

      const span = inner.style.getPropertyValue('--col-span');

      if (!span) return;

      // Apply proportional flex to Shopify wrapper
      wrapper.style.flex = span + ' 1 0';
      wrapper.style.minWidth = '0';

    });

  });

});
</script>

/* ================================
   Base Layout
================================ */
.layout-columns {
  display: flex;
  flex-wrap: wrap;
  gap: var(--gap, 20px);
  align-items: var(--align-items, stretch);
  justify-content: var(--justify-content, flex-start);
}

/* Now this works because variable is on this element */
.layout-columns > .shopify-block {
  flex: var(--col-span, 1) 1 0;
  min-width: 0;
  box-sizing: border-box;
}

/* Mobile */
@media (max-width: 767px) {

  .mobile-cols-1 > .shopify-block {
    flex: 0 0 100%;
  }

  .mobile-cols-2 > .shopify-block {
    flex: 0 0 calc(50% - var(--gap, 20px) / 2);
  }

}


{% endstyle %}

{% schema %}
{
  "name": "Columns",
  "blocks": [
    {
      "type": "column-item"
    }
  ],
  "settings": [
    {
      "type": "select",
      "id": "mobile_columns",
      "label": "Columns on mobile",
      "default": "1",
      "options": [
        { "value": "1", "label": "1 column" },
        { "value": "2", "label": "2 columns" }
      ]
    },
    {
      "type": "range",
      "id": "column_gap",
      "label": "Space between columns",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "select",
      "id": "align_items",
      "label": "Vertical alignment",
      "default": "stretch",
      "options": [
        { "value": "flex-start", "label": "Top" },
        { "value": "center", "label": "Middle" },
        { "value": "flex-end", "label": "Bottom" },
        { "value": "stretch", "label": "Stretch equal height" }
      ]
    },
    {
      "type": "select",
      "id": "justify_content",
      "label": "Horizontal alignment",
      "default": "flex-start",
      "options": [
        { "value": "flex-start", "label": "Align left" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Align right" },
        { "value": "space-between", "label": "Space between" },
        { "value": "space-around", "label": "Space around" },
        { "value": "space-evenly", "label": "Space evenly" }
      ]
    },
    {
      "type": "range",
      "id": "padding",
      "label": "Section padding",
      "default": 0,
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px"
    }
  ],
  "presets": [
    {
      "name": "Layout columns (row)"
    }
  ]
}
{% endschema %}
