{% doc %}
  Advanced Video Block
{% enddoc %}

{% liquid
  assign video_wrapper_classes = 'cropped-video-wrapper'
  assign wrapper_style = ''

  if block.settings.aspect_ratio == 'adapt-to-video'
    assign video_wrapper_classes = video_wrapper_classes | append: ' adapt-video-height'

  elsif block.settings.aspect_ratio == 'custom-height'
    assign video_wrapper_classes = video_wrapper_classes | append: ' custom-height-video'
    assign wrapper_style = 'height:' | append: block.settings.custom_height | append: 'px;'

  else
    assign video_wrapper_classes = video_wrapper_classes | append: ' ' | append: block.settings.aspect_ratio
  endif

  assign render_video = blank
  assign render_external = blank

  if block.settings.source_type == 'hosted'
    assign render_video = block.settings.video
  elsif block.settings.source_type == 'external'
    assign render_external = block.settings.external_video_url
  endif
%}

{% if render_video != blank or render_external != blank %}

  <div class="block-video" {{ block.shopify_attributes }}>

    {% render 'video',
      video: render_video,
      external_video_url: render_external,
      class: video_wrapper_classes,
      style: wrapper_style,
      autoplay: block.settings.autoplay,
      loop: block.settings.loop,
      muted: block.settings.muted,
      controls: block.settings.controls,
      custom_thumbnail: block.settings.custom_thumbnail
    %}

  </div>

{% endif %}


{% schema %}
{
  "name": "Video",
  "settings": [

    {
      "type": "select",
      "id": "source_type",
      "label": "Video source",
      "default": "hosted",
      "options": [
        { "value": "hosted", "label": "Shopify hosted video" },
        { "value": "external", "label": "External video URL" }
      ]
    },

    {
      "type": "video",
      "id": "video",
      "label": "Shopify hosted video",
      "visible_if": "{{ block.settings.source_type == 'hosted' }}"
    },

    {
      "type": "text",
      "id": "external_video_url",
      "label": "External video URL (YouTube/Vimeo)",
      "visible_if": "{{ block.settings.source_type == 'external' }}"
    },

    {
      "type": "image_picker",
      "id": "custom_thumbnail",
      "label": "Custom thumbnail image"
    },

    {
      "type": "header",
      "content": "Aspect Ratio"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "adapt-to-video",
      "options": [
        { "value": "adapt-to-video", "label": "Adapt to video" },
        { "value": "cropped-image--square", "label": "Square" },
        { "value": "cropped-image--portrait", "label": "Portrait" },
        { "value": "cropped-image--landscape", "label": "Landscape" },
        { "value": "cropped-image--wide", "label": "Wide (16:9)" },
        { "value": "custom-height", "label": "Custom height" }
      ]
    },
    {
      "type": "range",
      "id": "custom_height",
      "label": "Custom height (px)",
      "min": 100,
      "max": 1200,
      "step": 20,
      "unit": "px",
      "default": 400,
      "visible_if": "{{ block.settings.aspect_ratio == 'custom-height' }}"
    },

    {
      "type": "header",
      "content": "Playback"
    },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": false },
    {
      "type": "checkbox",
      "id": "muted",
      "label": "Muted",
      "default": true,
      "visible_if": "{{ block.settings.autoplay == false }}"
    },
    { "type": "checkbox", "id": "controls", "label": "Show controls", "default": true }

  ],
  "presets": [
    { "name": "Video" }
  ]
}


{% endschema %}