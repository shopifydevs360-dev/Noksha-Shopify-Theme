{% doc %}
  Advanced Video Block
{% enddoc %}

{% liquid
  assign video = block.settings.video
  assign external_video_url = block.settings.external_video_url

  assign video_wrapper_classes = 'cropped-video-wrapper'
  assign wrapper_style = ''

  if block.settings.aspect_ratio == 'adapt-to-video'
    assign video_wrapper_classes = video_wrapper_classes | append: ' adapt-video-height'

  elsif block.settings.aspect_ratio == 'custom-height'
    assign video_wrapper_classes = video_wrapper_classes | append: ' custom-height-video'
    assign wrapper_style = 'height:' | append: block.settings.custom_height | append: 'px;'

  else
    assign video_wrapper_classes = video_wrapper_classes | append: ' ' | append: block.settings.aspect_ratio
  endif
%}

{% if video or external_video_url != blank %}

  <div
    class="block-video"
    {{ block.shopify_attributes }}
  >

    {% render 'video',
      video: video,
      external_video_url: external_video_url,
      class: video_wrapper_classes,
      style: wrapper_style,
      autoplay: block.settings.autoplay,
      loop: block.settings.loop,
      muted: block.settings.muted,
      controls: block.settings.controls
    %}

  </div>

{% endif %}

{% schema %}
{
  "name": "Video",
  "settings": [
    {
      "type": "video",
      "id": "video",
      "label": "Shopify hosted video"
    },
    {
      "type": "text",
      "id": "external_video_url",
      "label": "External video URL (YouTube/Vimeo)"
    },

    {
      "type": "header",
      "content": "Aspect Ratio"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "adapt-to-video",
      "options": [
        { "value": "adapt-to-video", "label": "Adapt to video" },
        { "value": "cropped-image--square", "label": "Square" },
        { "value": "cropped-image--portrait", "label": "Portrait" },
        { "value": "cropped-image--landscape", "label": "Landscape" },
        { "value": "cropped-image--wide", "label": "Wide (16:9)" },
        { "value": "custom-height", "label": "Custom height" }
      ]
    },
    {
      "type": "range",
      "id": "custom_height",
      "label": "Custom height (px)",
      "min": 100,
      "max": 1200,
      "step": 20,
      "unit": "px",
      "default": 400,
      "visible_if": "{{ block.settings.aspect_ratio == 'custom-height' }}"
    },

    {
      "type": "header",
      "content": "Playback"
    },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": false },
    { "type": "checkbox", "id": "muted", "label": "Muted", "default": true },
    { "type": "checkbox", "id": "controls", "label": "Show controls", "default": true }
  ],
  "presets": [
    { "name": "Video" }
  ]
}


{% endschema %}