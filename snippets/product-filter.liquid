<form id="CollectionFilters" method="get">

  {% for block in section.blocks %}
    {% case block.type %}

    {%- comment -%}
    ======================
    AVAILABILITY FILTER
    ======================
    {%- endcomment -%}
    {% when 'availablity-filter' %}
      {% for filter in collection.filters %}
        {% if filter.label == 'Availability' %}
          <fieldset>
            <legend>Availability</legend>

            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


    {%- comment -%}
    ======================
    VENDOR / BRAND FILTER
    ======================
    {%- endcomment -%}
    {% when 'vendor-filter' %}
      {% for filter in collection.filters %}
        {% if filter.label == 'Vendor' or filter.label == 'Brand' %}
          <fieldset>
            <legend>{{ filter.label }}</legend>

            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


    {%- comment -%}
    ======================
    COLOR FILTER
    ======================
    {%- endcomment -%}
    {% when 'color-filter' %}
      {% assign allow_colors = block.settings.allow_colors | downcase | split: ',' | map: 'strip' %}
      {% assign disallow_colors = block.settings.disallow_colors | downcase | split: ',' | map: 'strip' %}

      {% for filter in collection.filters %}
        {% if filter.type == 'list' and filter.param_name contains 'color' %}
          <fieldset>
            <legend>{{ block.settings.filter_title }}</legend>

            {% for value in filter.values %}
              {% assign color = value.label | downcase | strip %}

              {% if allow_colors != blank and allow_colors contains color %}
                {% unless disallow_colors contains color %}
                  {% render 'filter-checkbox', value: value %}
                {% endunless %}
              {% elsif allow_colors == blank %}
                {% unless disallow_colors contains color %}
                  {% render 'filter-checkbox', value: value %}
                {% endunless %}
              {% endif %}
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


    {%- comment -%}
    ======================
    TAG FILTER (CUSTOM)
    ======================
    {%- endcomment -%}
    {% when 'tag-filter' %}
      {% assign allowed = block.settings.custom_filter_tags | downcase | split: ',' %}
      {% assign allowed_clean = '' | split: ',' %}

      {% for tag in allowed %}
        {% assign allowed_clean = allowed_clean | push: tag | map: 'strip' %}
      {% endfor %}

      {% for filter in collection.filters %}
        {% if filter.label contains 'Tag' %}
          <fieldset>
            <legend>{{ block.settings.filter_title }}</legend>

            {% for value in filter.values %}
              {% assign tag_label = value.label | downcase | strip %}
              {% if allowed_clean contains tag_label %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                  <span>({{ value.count }})</span>
                </label>
              {% endif %}
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


    {%- comment -%}
    ======================
    PRICE FILTER (CORRECT)
    ======================
    {%- endcomment -%}
{% when 'price-filter' %}
  {% for filter in collection.filters %}
    {% if filter.type == 'price_range' %}
      <fieldset>
        <legend>{{ block.settings.filter_title }}</legend>

        <label>
          Min
        <input
          type="number"
          name="{{ filter.min_value.param_name }}"
          value="{{ filter.min_value.value }}"
          min="0"
          max="{{ filter.range_max }}"
          placeholder="{{ 0 | money_without_trailing_zeros }}"
        >
        </label>

        <label>
          Max
        <input
          type="number"
          name="{{ filter.max_value.param_name }}"
          value="{{ filter.max_value.value }}"
          min="0"
          max="{{ filter.range_max }}"
          placeholder="{{ filter.range_max | money_without_trailing_zeros }}"
        >

        </label>
      </fieldset>
    {% endif %}
  {% endfor %}


    {%- comment -%}
    ======================
    PRODUCT TYPE FILTER
    ======================
    {%- endcomment -%}
    {% when 'product-type-filter' %}
      {% for filter in collection.filters %}
        {% if filter.label == 'Product type' %}
          <fieldset>
            <legend>{{ block.settings.filter_title }}</legend>

            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


    {%- comment -%}
    ======================
    SIZE FILTER
    ======================
    {%- endcomment -%}
    {% when 'size-filter' %}
      {% for filter in collection.filters %}
        {% if filter.label == 'Size' %}
          <fieldset>
            <legend>{{ block.settings.filter_title }}</legend>

            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {% endcase %}
  {% endfor %}
  <a href="{{ collection.url }}" id="clearFiltersBtn">Clear All</a>

</form>
