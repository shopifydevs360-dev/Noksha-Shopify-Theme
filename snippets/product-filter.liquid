<form id="CollectionFilters" class="collection-filters-form" data-collection-handle="{{ collection.handle }}">
  
  {%- for block in section.blocks -%}
    {%- case block.type -%}
    
      {%- when 'availability-filter' -%}
        {%- assign availability_filter = collection.filters | where: "label", "Availability" | first -%}
        {%- if availability_filter -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>Availability</h3>
            {%- for value in availability_filter.values -%}
              <label class="filter-label">
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                  {% if value.count == 0 and value.active == false %}disabled{% endif %}
                  data-filter-input
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {%- endfor -%}
          </div>
        {%- endif -%}

      {%- when 'vendor-filter' -%}
        {%- assign vendor_filter = collection.filters | where: "label", "Vendor" | first -%}
        {%- if vendor_filter -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Vendor' }}</h3>
            {%- for value in vendor_filter.values -%}
              <label class="filter-label">
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                  {% if value.count == 0 and value.active == false %}disabled{% endif %}
                  data-filter-input
                >
                {{ value.label }}
                <span>({{ value.count }})</span>
              </label>
            {%- endfor -%}
          </div>
        {%- endif -%}

      {%- when 'collection-filter' -%}
        {%- if block.settings.collection_menu -%}
          {%- assign menu = linklists[block.settings.collection_menu] -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>Collections</h3>
            {%- for link in menu.links -%}
              {%- if link.type == 'collection_link' -%}
                <label class="filter-label">
                  <input
                    type="radio"
                    name="collection_handle"
                    value="{{ link.object.handle }}"
                    {% if current_tags contains link.object.handle %}checked{% endif %}
                    data-filter-input
                  >
                  {{ link.title }}
                </label>
              {%- endif -%}
            {%- endfor -%}
            <label class="filter-label">
              <input 
                type="radio" 
                name="collection_handle" 
                value="" 
                {% unless current_tags %}checked{% endunless %}
                data-filter-input
              >
              All Collections
            </label>
          </div>
        {%- endif -%}

      {%- when 'color-filter' -%}
        {%- assign color_filter = collection.filters | where: "label", "Color" | first -%}
        {%- if color_filter -%}
          {%- assign allow_colors = block.settings.allow_colors | downcase | split: ',' | strip_newlines -%}
          {%- assign disallow_colors = block.settings.disallow_colors | downcase | split: ',' | strip_newlines -%}
          
          <div class="filter-group filter-group--color" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Color' }}</h3>
            {%- for value in color_filter.values -%}
              {%- assign value_lower = value.label | downcase | strip -%}
              {%- assign should_show = true -%}
              
              {%- if allow_colors.size > 0 and allow_colors.first != blank -%}
                {%- unless allow_colors contains value_lower -%}
                  {%- assign should_show = false -%}
                {%- endunless -%}
              {%- endif -%}
              
              {%- if disallow_colors.size > 0 and disallow_colors.first != blank -%}
                {%- if disallow_colors contains value_lower -%}
                  {%- assign should_show = false -%}
                {%- endif -%}
              {%- endif -%}
              
              {%- if should_show -%}
                <label class="filter-label color-filter-label">
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                    data-filter-input
                  >
                  <span class="color-swatch" style="background-color: {{ value.label | handle }};"></span>
                  {{ value.label }}
                  <span>({{ value.count }})</span>
                </label>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

      {%- when 'tag-filter' -%}
        {%- assign tag_filter = collection.filters | where: "param_name", "filter.p.tag" | first -%}
        {%- if tag_filter -%}
          {%- assign allowed_tags = block.settings.custom_filter_tags | downcase | split: ',' | strip -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Tags' }}</h3>
            {%- for value in tag_filter.values -%}
              {%- assign tag_lower = value.label | downcase | strip -%}
              {%- if allowed_tags.size == 0 or allowed_tags.first == blank or allowed_tags contains tag_lower -%}
                <label class="filter-label">
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                    data-filter-input
                  >
                  {{ value.label }}
                  <span>({{ value.count }})</span>
                </label>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

      {%- when 'price-filter' -%}
        {%- assign price_filter = collection.filters | where: "type", "price_range" | first -%}
        {%- if price_filter -%}
          <div class="filter-group price-filter" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Price' }}</h3>
            <div class="range-input">
              <input
                type="range"
                class="min-price"
                min="0"
                max="{{ price_filter.range_max | divided_by: 100.0 }}"
                value="{{ price_filter.min_value.value | divided_by: 100.0 | default: 0 }}"
                data-min-input
              >
              <input
                type="range"
                class="max-price"
                min="0"
                max="{{ price_filter.range_max | divided_by: 100.0 }}"
                value="{{ price_filter.max_value.value | divided_by: 100.0 | default: price_filter.range_max | divided_by: 100.0 }}"
                data-max-input
              >
            </div>
            <div class="price-input">
              <label>
                Min
                <input
                  type="number"
                  name="{{ price_filter.min_value.param_name }}"
                  value="{{ price_filter.min_value.value | divided_by: 100.0 }}"
                  min="0"
                  max="{{ price_filter.range_max | divided_by: 100.0 }}"
                  placeholder="0"
                  data-min-display
                  data-filter-input
                >
              </label>
              <label>
                Max
                <input
                  type="number"
                  name="{{ price_filter.max_value.param_name }}"
                  value="{{ price_filter.max_value.value | divided_by: 100.0 }}"
                  min="0"
                  max="{{ price_filter.range_max | divided_by: 100.0 }}"
                  placeholder="{{ price_filter.range_max | divided_by: 100.0 }}"
                  data-max-display
                  data-filter-input
                >
              </label>
            </div>
          </div>
        {%- endif -%}

      {%- when 'product-type-filter' -%}
        {%- assign type_filter = collection.filters | where: "label", "Product type" | first -%}
        {%- if type_filter or block.settings.product_types -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Product Type' }}</h3>
            
            {%- if block.settings.product_types -%}
              {%- assign custom_types = block.settings.product_types | split: ',' | strip -%}
              {%- for type in custom_types -%}
                <label class="filter-label">
                  <input
                    type="checkbox"
                    name="filter.p.product_type"
                    value="{{ type }}"
                    {% if current_tags contains type %}checked{% endif %}
                    data-filter-input
                  >
                  {{ type }}
                </label>
              {%- endfor -%}
            {%- else -%}
              {%- for value in type_filter.values -%}
                <label class="filter-label">
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                    data-filter-input
                  >
                  {{ value.label }}
                  <span>({{ value.count }})</span>
                </label>
              {%- endfor -%}
            {%- endif -%}
          </div>
        {%- endif -%}

      {%- when 'size-filter' -%}
        {%- assign size_filter = collection.filters | where: "label", "Size" | first -%}
        {%- if size_filter -%}
          {%- assign allowed_sizes = block.settings.sizes | downcase | split: ',' | strip -%}
          <div class="filter-group" {{ block.shopify_attributes }}>
            <h3>{{ block.settings.filter_title | default: 'Size' }}</h3>
            {%- for value in size_filter.values -%}
              {%- assign size_lower = value.label | downcase | strip -%}
              {%- if allowed_sizes.size == 0 or allowed_sizes.first == blank or allowed_sizes contains size_lower -%}
                <label class="filter-label">
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                    data-filter-input
                  >
                  {{ value.label }}
                  <span>({{ value.count }})</span>
                </label>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

    {%- endcase -%}
  {%- endfor -%}

  <div class="filter-actions">
    <button type="button" class="btn btn--primary apply-filters-btn">Apply Filters</button>
    <button type="button" class="btn btn--secondary clear-filters-btn">Clear All</button>
  </div>

</form>