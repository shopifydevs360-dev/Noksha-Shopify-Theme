<form id="CollectionFilters">

  {% for block in section.blocks %}
    {% case block.type %}

    {% when 'availablity-filter' %}
      {% for filter in collection.filters %}
        {% if filter.label == 'Availability' %}
          <fieldset>
            <legend>Availability</legend>

            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >

                {{ value.label }}
                <span class="filter-count">({{ value.count }})</span>
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}


      {% when 'vendor-filter' %}
        {% for filter in collection.filters %}
          {% if filter.label == 'Brand' or filter.label == 'Vendor' %}
            <fieldset>
              <legend>{{ filter.label }}</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

      {% when 'collection-filter' %}
        <fieldset>
          <legend>Collections</legend>
          {% assign menu = linklists[block.settings.collection_menu] %}
          {% if menu.links.size > 0 %}
            {% for link in menu.links %}
              {% assign handle = link.object.handle %}
              <label>
                <input
                  type="radio"
                  name="collection_handle"
                  value="{{ handle }}"
                >
                {{ link.title }}
              </label>
            {% endfor %}
            <label>
              <input type="radio" name="collection_handle" value="" checked>
              All
            </label>
          {% else %}
            <p>No menu selected.</p>
          {% endif %}
        </fieldset>

      {% when 'color-filter' %}
        {% for filter in collection.filters %}
          {% if filter.label == 'Color' %}
            <fieldset>
              <legend>Color</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

      {% when 'tag-filter' %}
        {% assign allowed = block.settings.custom_filter_tags | downcase | split: ',' %}
        {% assign allowed_clean = '' | split: ',' %}

        {% for tag in allowed %}
          {% assign clean = tag | strip %}
          {% assign allowed_clean = allowed_clean | push: clean %}
        {% endfor %}

        {% for filter in collection.filters %}
          {% if filter.label contains 'Tag' %}
            <fieldset>
              <legend>{{ block.settings.filter_title }}</legend>

              {% for value in filter.values %}
                {% assign tagLabel = value.label | downcase | strip %}
                {% if allowed_clean contains tagLabel %}
                  <label>
                    <input
                      type="checkbox"
                      name="{{ value.param_name }}"
                      value="{{ value.value }}"
                      {% if value.active %}checked{% endif %}
                    >
                    {{ value.label }}
                  </label>
                {% endif %}
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

{% when 'price-filter' %}
  {% for filter in collection.filters %}
    {% if filter.type == 'price_range' %}

      {% assign real_max = collection.price_range.max | money_without_currency %}
      {% assign min_value = filter.min_value.value | default: 0 %}
      {% assign max_value = filter.max_value.value | default: real_max %}

      <fieldset class="price-range">
        <legend>{{ block.settings.filter_title }}</legend>

        <!-- Hidden Shopify inputs -->
        <input
          type="hidden"
          name="{{ filter.min_value.param_name }}"
          id="PriceMinInput"
          value="{{ min_value }}"
        >
        <input
          type="hidden"
          name="{{ filter.max_value.param_name }}"
          id="PriceMaxInput"
          value="{{ max_value }}"
        >

        <!-- Slider -->
        <div class="range-slider">
          <div class="range-track"></div>
          <div class="range-fill" id="RangeFill"></div>

          <input
            type="range"
            min="0"
            max="{{ real_max }}"
            value="{{ min_value }}"
            id="MinRange"
          >

          <input
            type="range"
            min="0"
            max="{{ real_max }}"
            value="{{ max_value }}"
            id="MaxRange"
          >

          <div class="price-bubble min" id="MinBubble">
            {{ min_value | money }}
          </div>

          <div class="price-bubble max" id="MaxBubble">
            {{ max_value | money }}
          </div>
        </div>
      </fieldset>

    {% endif %}
  {% endfor %}



      {% when 'product-type-filter' %}
        {% assign types = block.settings.product_types | split: ',' %}
        <fieldset>
          <legend>{{ block.settings.filter_title }}</legend>
          {% for type in types %}
            {% assign clean_type = type | strip %}
            {% if clean_type != blank %}
              <label>
                <input
                  type="checkbox"
                  name="filter.p.product_type"
                  value="{{ clean_type }}"
                >
                {{ clean_type }}
              </label>
            {% endif %}
          {% endfor %}
        </fieldset>

      {% when 'size-filter' %}
        {% assign sizes = block.settings.sizes | split: ',' %}
        <fieldset>
          <legend>{{ block.settings.filter_title }}</legend>
          {% for size in sizes %}
            {% assign clean_size = size | strip %}
            {% if clean_size != blank %}
              <label>
                <input
                  type="checkbox"
                  name="filter.v.option.size"
                  value="{{ clean_size }}"
                >
                {{ clean_size }}
              </label>
            {% endif %}
          {% endfor %}
        </fieldset>

    {% endcase %}
  {% endfor %}

  <button type="button" id="clearFiltersBtn">Clear All</button>

</form>
