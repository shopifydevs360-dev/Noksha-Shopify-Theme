<form id="CollectionFilters" method="get">

  {% for block in section.blocks %}
    {% case block.type %}

      {%- when 'availablity-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.label == 'Availability' and filter.values.size > 0 %}
            <fieldset class="filter filter--availability">
              <legend>Availability</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }} ({{ value.count }})
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

      {%- when 'vendor-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.label == 'Vendor' or filter.label == 'Brand' %}
            {% if filter.values.size > 0 %}
              <fieldset class="filter filter--vendor">
                <legend>{{ filter.label }}</legend>
                {% for value in filter.values %}
                  <label>
                    <input
                      type="checkbox"
                      name="{{ value.param_name }}"
                      value="{{ value.value }}"
                      {% if value.active %}checked{% endif %}
                    >
                    {{ value.label }} ({{ value.count }})
                  </label>
                {% endfor %}
              </fieldset>
            {% endif %}
          {% endif %}
        {% endfor %}

      {%- when 'collection-filter' -%}
        {% assign menu = linklists[block.settings.collection_menu] %}
        {% if menu and menu.links.size > 0 %}
          <fieldset class="filter filter--collections">
            <legend>Collections</legend>

            {% assign has_collection_links = false %}

            {% for link in menu.links %}
              {% if link.type == 'collection_link' %}
                {% assign has_collection_links = true %}
                <label>
                  <input
                    type="radio"
                    name="collection_handle"
                    value="{{ link.object.handle }}"
                    {% if collection and link.object.handle == collection.handle %}checked{% endif %}
                  >
                  {{ link.title }}
                </label>
              {% endif %}
            {% endfor %}

            {% unless has_collection_links %}
              <p>No collection links found.</p>
            {% endunless %}
          </fieldset>
        {% endif %}

      {%- when 'color-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.label == 'Color' and filter.values.size > 0 %}
            <fieldset class="filter filter--color">
              <legend>Color</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }} ({{ value.count }})
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

      {%- when 'tag-filter' -%}
        {% assign raw_allowed_tags = block.settings.custom_filter_tags | strip %}
        {% assign allowed_tags = raw_allowed_tags | downcase | split: ',' %}
        {% assign has_visible_tags = false %}

        {% for filter in collection.filters %}
          {% if filter.param_name contains '.tag' %}
            {% capture tag_items %}
              {% for value in filter.values %}
                {% assign tag_label = value.label | downcase | strip %}
                {% if raw_allowed_tags == blank or allowed_tags contains tag_label %}
                  {% assign has_visible_tags = true %}
                  <label>
                    <input
                      type="checkbox"
                      name="{{ value.param_name }}"
                      value="{{ value.value }}"
                      {% if value.active %}checked{% endif %}
                    >
                    {{ value.label }} ({{ value.count }})
                  </label>
                {% endif %}
              {% endfor %}
            {% endcapture %}

            {% if has_visible_tags %}
              <fieldset class="filter filter--tags">
                <legend>{{ block.settings.filter_title }}</legend>
                {{ tag_items }}
              </fieldset>
            {% endif %}
          {% endif %}
        {% endfor %}

      {%- when 'price-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.type == 'price_range' %}
            <fieldset class="filter filter--price">
              <legend>{{ block.settings.filter_title }}</legend>

              <label>
                Min
                <input
                  type="number"
                  name="{{ filter.min_value.param_name }}"
                  value="{{ filter.min_value.value }}"
                  min="0"
                  max="{{ filter.range_max }}"
                >
              </label>

              <label>
                Max
                <input
                  type="number"
                  name="{{ filter.max_value.param_name }}"
                  value="{{ filter.max_value.value }}"
                  min="0"
                  max="{{ filter.range_max }}"
                >
              </label>
            </fieldset>
          {% endif %}
        {% endfor %}

      {%- when 'product-type-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.label == 'Product type' and filter.values.size > 0 %}
            <fieldset class="filter filter--product-type">
              <legend>{{ block.settings.filter_title }}</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }} ({{ value.count }})
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

      {%- when 'size-filter' -%}
        {% for filter in collection.filters %}
          {% if filter.type == 'list' and filter.label == block.settings.filter_title %}
            <fieldset class="filter filter--size">
              <legend>{{ block.settings.filter_title }}</legend>
              {% for value in filter.values %}
                {% assign short_label = value.label | split: '(' | last | split: ')' | first | strip %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ short_label }} ({{ value.count }})
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}
        {% endfor %}

    {% endcase %}
  {% endfor %}

  <div class="filter-actions">
    <button type="submit" class="btn btn--apply">
      Apply Filters
    </button>

    <button
      type="button"
      class="btn btn--clear" id="applyFiltersBtn"
      onclick="window.location.href='{{ collection.url }}'">
      Clear All
    </button>
  </div>

</form>
