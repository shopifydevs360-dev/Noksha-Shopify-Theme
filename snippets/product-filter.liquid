<form id="CollectionFilters" method="get">

  {% for block in section.blocks %}
    {% case block.type %}

    {%- comment -%} ================= AVAILABILITY ================= {%- endcomment -%}
    {% when 'availability-filter' %}
      {% for filter in collection.filters %}
        {% if filter.type == 'availability' %}
          <fieldset>
            <legend>{{ filter.label }}</legend>
            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }} ({{ value.count }})
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {%- comment -%} ================= VENDOR ================= {%- endcomment -%}
    {% when 'vendor-filter' %}
      {% for filter in collection.filters %}
        {% if filter.type == 'vendor' %}
          <fieldset>
            <legend>{{ filter.label }}</legend>
            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }} ({{ value.count }})
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {%- comment -%} ================= COLOR ================= {%- endcomment -%}
    {% when 'color-filter' %}
      {% for filter in collection.filters %}
        {% if filter.param_name contains 'filter.v.option.color' %}
          <fieldset>
            <legend>{{ filter.label }}</legend>
            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {%- comment -%} ================= SIZE ================= {%- endcomment -%}
    {% when 'size-filter' %}
      {% for filter in collection.filters %}
        {% if filter.param_name contains 'filter.v.option.size' %}
          <fieldset>
            <legend>{{ filter.label }}</legend>
            {% for value in filter.values %}
              <label>
                <input
                  type="checkbox"
                  name="{{ value.param_name }}"
                  value="{{ value.value }}"
                  {% if value.active %}checked{% endif %}
                >
                {{ value.label }}
              </label>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {%- comment -%} ================= TAG FILTER (CUSTOM LIST) ================= {%- endcomment -%}
    {% when 'tag-filter' %}
      {% assign allowed_tags = block.settings.custom_filter_tags | downcase | split: ',' %}
      {% assign allowed = '' | split: ',' %}

      {% for tag in allowed_tags %}
        {% assign clean = tag | strip %}
        {% assign allowed = allowed | push: clean %}
      {% endfor %}

      {% for filter in collection.filters %}
        {% if filter.label contains 'Tag' %}
          <fieldset>
            <legend>{{ block.settings.filter_title }}</legend>
            {% for value in filter.values %}
              {% assign label = value.label | downcase | strip %}
              {% if allowed contains label %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                </label>
              {% endif %}
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endfor %}

    {%- comment -%} ================= PRICE ================= {%- endcomment -%}
    {% when 'price-filter' %}
      {% assign price_filter = collection.filters | where: "type", "price_range" | first %}
      {% if price_filter %}
        <fieldset>
          <legend>{{ block.settings.filter_title }}</legend>

          <label>
            Min
            <input
              type="number"
              name="{{ price_filter.min_value.param_name }}"
              value="{{ price_filter.min_value.value | default: '' }}"
              min="0"
            >
          </label>

          <label>
            Max
            <input
              type="number"
              name="{{ price_filter.max_value.param_name }}"
              value="{{ price_filter.max_value.value | default: '' }}"
              min="0"
            >
          </label>
        </fieldset>
      {% endif %}

    {% endcase %}
  {% endfor %}

  <div class="filter-actions">
    <button type="submit">Apply Filters</button>
    <button type="button" id="clearFiltersBtn">Clear All</button>
  </div>
</form>
