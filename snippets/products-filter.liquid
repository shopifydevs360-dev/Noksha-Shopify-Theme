<form id="CollectionFilters" class="collection-filters">

  {% if collection.filters.size > 0 %}

    {%- comment -%}
      SHOPIFY NATIVE FILTERS (Pagination-safe)
    {%- endcomment -%}

    {% for block in section.blocks %}
      {% case block.type %}

        {% when 'availablity-filter' %}
          {% assign filter = collection.filters | where: 'type', 'availability' | first %}
          {% if filter %}
            <fieldset class="filter-group">
              <legend>Availability</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}

        {% when 'vendor-filter' %}
          {% assign filter = collection.filters | where: 'type', 'vendor' | first %}
          {% if filter %}
            <fieldset class="filter-group">
              <legend>Brand</legend>
              {% for value in filter.values %}
                <label>
                  <input
                    type="checkbox"
                    name="{{ value.param_name }}"
                    value="{{ value.value }}"
                    {% if value.active %}checked{% endif %}
                  >
                  {{ value.label }}
                </label>
              {% endfor %}
            </fieldset>
          {% endif %}

        {% when 'custom-filter' %}
          {% assign filter = collection.filters | where: 'type', 'tag' | first %}
          {% if filter %}
            {% assign allowed_tags = block.settings.custom_filter_tags | downcase | split: ',' %}
            <fieldset class="filter-group">
              <legend>{{ block.settings.filter_title }}</legend>
              {% for value in filter.values %}
                {% assign label_down = value.label | downcase %}
                {% if allowed_tags contains label_down %}
                  <label>
                    <input
                      type="checkbox"
                      name="{{ value.param_name }}"
                      value="{{ value.value }}"
                      {% if value.active %}checked{% endif %}
                    >
                    {{ value.label }}
                  </label>
                {% endif %}
              {% endfor %}
            </fieldset>
          {% endif %}

      {% endcase %}
    {% endfor %}

  {% else %}

    {%- comment -%}
      FALLBACK UI (ALWAYS SHOWS, CLIENT-SIDE)
    {%- endcomment -%}

    {% for block in section.blocks %}
      {% case block.type %}

        {% when 'availablity-filter' %}
          <fieldset class="filter-group">
            <legend>Availability</legend>
            <label>
              <input type="checkbox" data-fallback-filter="availability">
              In stock
            </label>
          </fieldset>

        {% when 'collection-filter' %}
          <fieldset class="filter-group">
            <legend>Collections</legend>
            {% for c in collections %}
              <label>
                <input type="checkbox">
                {{ c.title }}
              </label>
            {% endfor %}
          </fieldset>

        {% when 'vendor-filter' %}
          <fieldset class="filter-group">
            <legend>Brand</legend>
            {% for vendor in collection.all_vendors %}
              <label>
                <input type="checkbox">
                {{ vendor }}
              </label>
            {% endfor %}
          </fieldset>

        {% when 'custom-filter' %}
          <fieldset class="filter-group">
            <legend>{{ block.settings.filter_title }}</legend>
            {% assign tags = block.settings.custom_filter_tags | split: ',' %}
            {% for tag in tags %}
              <label>
                <input type="checkbox">
                {{ tag | strip }}
              </label>
            {% endfor %}
          </fieldset>

      {% endcase %}
    {% endfor %}

  {% endif %}

</form>
