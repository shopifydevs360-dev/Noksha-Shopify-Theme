{% doc %}
  Renders a responsive image that might be wrapped in a link.

  When `width`, `height` and `crop` are provided, the image will be rendered
  with a fixed aspect ratio.

  Serves as an example of how to use the `image_url` filter and `image_tag` filter
  as well as how you can use LiquidDoc to document your code.

  @param {image} image - The image to be rendered
  @param {string} [url] - An optional destination URL for the image
  @param {string} [class] - Optional class to be added to the image wrapper {{ product.featured_image.width }} {{ section.settings.image.width }}
  @param {number} [width] - The highest resolution width of the image to be rendered {{ product.featured_image.height }}
  @param {number} [height] - The highest resolution height of the image to be rendered
  @param {string} [crop] - The crop position of the image
  @param {string} [img_alt] - The crop position of the image
  @param {string} [mobile_image] - Responsize image can added
  @param {string} [style] - custom style in the image

  @example
  {% render 'image', image: product.featured_image %}
  {% render 'image', image: product.featured_image, url: product.url %}
  {% render 'image',
    class: 'product__image {{ section.settings.image_wapper_class }}',
    image: product.featured_image,
    url: product.url,
    width: {{ image.width }},
    height: {{ image.height }},
    crop: 'center',
    mobile_image: block.settings.image_mobile,
    img_alt: collection.title,
    style: wrapper_style
  %}
{% enddoc %}

{% liquid
  unless height
    assign width = width | default: image.width
  endunless

  if url
    assign wrapper = 'a'
  else
    assign wrapper = 'div'
  endif

  assign wrapper_style = style | default: ''

%}

<{{ wrapper }}
  class="image {{ class }}"
  {% if url %}
    href="{{ url }}"
  {% endif %}
  {% if wrapper_style != blank %}
    style="{{ wrapper_style }}"
  {% endif %}
>
  {% if mobile_image %}
    <picture>
      <!-- Mobile image -->
      <source
        media="(max-width: 768px)"
        srcset="{{ mobile_image | image_url: width: 768 }}"
      >

      <!-- Desktop / default image -->
      {{ image
        | image_url: width: width, height: height, crop: crop
        | image_tag:
          alt: img_alt,
          loading: 'lazy',
          decoding: 'async'
      }}
    </picture>
  {% else %}
    {{ image
      | image_url: width: width, height: height, crop: crop
      | image_tag:
        alt: img_alt,
        loading: 'lazy',
        decoding: 'async',
        widths: '360, 533, 720, 940, 1066, 1500',
    }}
  {% endif %}
</{{ wrapper }}>
