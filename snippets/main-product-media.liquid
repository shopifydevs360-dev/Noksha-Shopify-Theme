{%- liquid
  if product == blank
    echo 'Product media unavailable'
    break
  endif

  assign media_count = product.media.size
  assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.media.first
-%}

<div class="product-media">

  <!-- =====================
       MAIN SWIPER SLIDER
  ====================== -->
  <div class="product-media__main swiper js-product-main-slider">
    <div class="swiper-wrapper">

      {% for media in product.media %}
        {% if media.media_type == 'image' %}
          <div 
            class="swiper-slide"
            data-media-id="{{ media.id }}"
          >
            {% render 'image',
              class: 'js-open-lightbox',
              image: media,
              width: media.width,
              height: media.height,
              crop: 'center',
              img_alt: media.alt
            %}
          </div>
        {% endif %}
      {% endfor %}

    </div>

    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-pagination"></div>
  </div>


  <!-- =====================
       VIDEO ROW (IF EXISTS)
  ====================== -->
  {% assign has_video = false %}
  {% for media in product.media %}
    {% if media.media_type contains 'video' %}
      {% assign has_video = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if has_video %}
    <div class="product-media__video-row">
      {% for media in product.media %}
        {% if media.media_type contains 'video' %}
          <div class="product-media__video">
            {{ media | video_tag:
              autoplay: true,
              loop: true,
              muted: true,
              controls: false,
              playsinline: true,
              preload: 'metadata'
            }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}


  <!-- =====================
       THUMBNAILS
  ====================== -->
  {% if media_count > 1 %}
    <div class="product-media__thumbs swiper js-product-thumbs">
      <div class="swiper-wrapper">

        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            <div 
              class="swiper-slide"
              data-media-id="{{ media.id }}"
            >
              {% render 'image',
                image: media,
                crop: 'center',
                width: media.width,
                height: media.height,
                img_alt: media.alt
              %}
            </div>
          {% endif %}
        {% endfor %}

      </div>
    </div>
  {% endif %}

</div>



<!-- =====================
     LIGHTBOX
====================== -->
<div class="media-lightbox" id="mediaLightbox">
  <div class="media-lightbox__overlay"></div>

  <div class="media-lightbox__content">
    <button class="media-lightbox__close" aria-label="Close">Ã—</button>

    <div class="swiper media-lightbox__slider js-lightbox-slider">
      <div class="swiper-wrapper">

        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            <div class="swiper-slide">
              {% render 'image',
                image: media,
                width: media.width,
                height: media.height,
                img_alt: media.alt,
                loading: 'eager'
              %}
            </div>
          {% endif %}
        {% endfor %}

      </div>

      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>
</div>
