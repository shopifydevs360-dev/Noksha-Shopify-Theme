{%- liquid
  if product == blank
    echo 'Product media unavailable'
    break
  endif

  assign media_count = product.media.size
-%}

<div class="product-media" data-product-media>

  {% if media_count > 0 %}
  <!-- ======================
       MAIN SLIDER
  ======================= -->
  <div class="product-media__main swiper" data-main-slider>
    <div class="swiper-wrapper">

      {% for media in product.media %}
        <div class="swiper-slide"
             data-media-id="{{ media.id }}"
             data-lightbox-index="{{ forloop.index0 }}">

          {% case media.media_type %}

            {% when 'image' %}
              {% render 'image',
                image: media,
                width: media.width,
                height: media.height,
                img_alt: media.alt,
                class: 'product-media__image js-open-lightbox',
                loading: forloop.first | default: 'eager' | replace: 'true', 'eager' | replace: 'false', 'lazy'
              %}

            {% when 'video' %}
              {{ media | video_tag:
                controls: true,
                autoplay: false,
                loop: false,
                muted: false,
                playsinline: true,
                preload: 'metadata'
              }}

            {% when 'external_video' %}
              {{ media | external_video_tag }}

            {% when 'model' %}
              {{ media | model_viewer_tag }}

          {% endcase %}
        </div>
      {% endfor %}

    </div>

    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-pagination"></div>
  </div>


  <!-- ======================
       THUMBNAILS
  ======================= -->
  {% if media_count > 1 %}
  <div class="product-media__thumbs swiper" data-thumb-slider>
    <div class="swiper-wrapper">

      {% for media in product.media %}
        <div class="swiper-slide"
             data-media-id="{{ media.id }}"
             data-lightbox-index="{{ forloop.index0 }}">

          {% if media.media_type == 'image' %}
            {% render 'image',
              image: media,
              width: 150,
              height: 150,
              crop: 'center',
              img_alt: media.alt,
              loading: 'lazy'
            %}
          {% else %}
            <div class="thumb-video-label">Video</div>
          {% endif %}
        </div>
      {% endfor %}

    </div>
  </div>
  {% endif %}

  {% endif %}
</div>


<!-- ======================
     LIGHTBOX
====================== -->
<div class="media-lightbox" data-media-lightbox aria-hidden="true" role="dialog">

  <div class="media-lightbox__overlay"></div>

  <div class="media-lightbox__content">
    <button class="media-lightbox__close" aria-label="Close">Ã—</button>

    <div class="swiper media-lightbox__slider" data-lightbox-slider>
      <div class="swiper-wrapper">

        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            <div class="swiper-slide">
              {% render 'image',
                image: media,
                width: media.width,
                height: media.height,
                img_alt: media.alt,
                loading: 'lazy'
              %}
            </div>
          {% endif %}
        {% endfor %}

      </div>

      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-pagination"></div>
    </div>

  </div>
</div>
