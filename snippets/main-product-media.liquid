{%- liquid
  if product == blank
    echo 'Product media unavailable'
    break
  endif

  assign media_count = product.media.size
  assign variant_media = product.selected_or_first_available_variant.featured_media
  assign first_product_media = product.media.first
-%}

<div class="product-media">

  <!-- =====================
       MAIN SWIPER SLIDER
  ====================== -->
  <div class="product-media__main swiper hide-tablet hide-mobile hide-tablet-landscape">
    <div class="swiper-wrapper">

      {%- comment -%}
      1️⃣ Variant image FIRST (if exists)
      {%- endcomment -%}
      {% if variant_media %}
        <div class="swiper-slide">
          {% if variant_media.media_type contains 'video' %}
            {{ variant_media | video_tag:
              autoplay: true,
              loop: true,
              muted: true,
              controls: false,
              playsinline: true,
              preload: 'metadata'
            }}
          {% else %}
            {% render 'image',
              class: 'js-open-lightbox',
              image: variant_media,
              width: variant_media.width,
              height: variant_media.height,
              crop: 'center',
              img_alt: variant_media.alt
            %}
          {% endif %}
        </div>
      {% endif %}

      {%- comment -%}
      2️⃣ First product image (if different from variant)
      {%- endcomment -%}
      {% if first_product_media and first_product_media.id != variant_media.id %}
        <div class="swiper-slide">
          {% render 'image',
            class: 'js-open-lightbox',
            image: first_product_media,
            width: first_product_media.width,
            height: first_product_media.height,
            crop: 'center',
            img_alt: first_product_media.alt
          %}
        </div>
      {% endif %}

      {%- comment -%}
      3️⃣ Remaining media
      {%- endcomment -%}
      {% for media in product.media %}
        {% unless media.id == variant_media.id or media.id == first_product_media.id %}
          <div class="swiper-slide">
            {% if media.media_type contains 'video' %}
              {{ media | video_tag:
                autoplay: true,
                loop: true,
                muted: true,
                controls: false,
                playsinline: true,
                preload: 'metadata'
              }}
            {% else %}
              {% render 'image',
                class: 'js-open-lightbox',
                image: media,
                width: media.width,
                height: media.height,
                crop: 'center',
                img_alt: media.alt
              %}
            {% endif %}
          </div>
        {% endunless %}
      {% endfor %}

    </div>

    <!-- Navigation -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-pagination"></div>
  </div>


  <!-- =====================
       THUMB SLIDER (unchanged)
  ====================== -->
  {% if media_count > 1 %}
    <div class="product-media__thumbs swiper">
      <div class="swiper-wrapper">

        {% for media in product.media %}
          <div class="swiper-slide">
            {% if media.media_type == 'image' %}
              {% render 'image',
                image: media,
                width: media.width,
                height: media.height,
                crop: 'center',
                img_alt: media.alt
              %}
            {% endif %}
          </div>
        {% endfor %}

      </div>
    </div>
  {% endif %}

</div>
