{% doc %}
  Responsive Video Snippet

  @param {video} [video] - Shopify hosted video object
  @param {string} [external_video_url] - YouTube or Vimeo URL
  @param {string} [url] - Optional wrapper link
  @param {string} [class] - Custom wrapper class
  @param {string} [style] - Inline wrapper style
  @param {boolean} [autoplay]
  @param {boolean} [loop]
  @param {boolean} [muted]
  @param {boolean} [controls]

  @example
  {% render 'video', video: section.settings.video %}
  {% render 'video', external_video_url: block.settings.video_url %}
{% enddoc %}

{% liquid
  if url
    assign wrapper = 'a'
  else
    assign wrapper = 'div'
  endif

  assign wrapper_style = style | default: ''
%}

<{{ wrapper }}
  class="video {{ class }}"
  {% if url %}
    href="{{ url }}"
  {% endif %}
  {% if wrapper_style != blank %}
    style="{{ wrapper_style }}"
  {% endif %}
>

  {% if video %}
    {{ video
      | video_tag:
        autoplay: autoplay,
        loop: loop,
        muted: muted,
        controls: controls,
        playsinline: true
    }}

  {% elsif external_video_url != blank %}

    {% if external_video_url contains 'youtube.com' or external_video_url contains 'youtu.be' %}
      {% assign video_id = external_video_url | split: 'v=' | last | split: '&' | first %}
      <div class="video-embed">
        <iframe
          src="https://www.youtube.com/embed/{{ video_id }}?playsinline=1"
          frameborder="0"
          allow="autoplay; encrypted-media"
          allowfullscreen
        ></iframe>
      </div>

    {% elsif external_video_url contains 'vimeo.com' %}
      {% assign video_id = external_video_url | split: '/' | last %}
      <div class="video-embed">
        <iframe
          src="https://player.vimeo.com/video/{{ video_id }}"
          frameborder="0"
          allow="autoplay; fullscreen"
          allowfullscreen
        ></iframe>
      </div>
    {% endif %}

  {% endif %}

</{{ wrapper }}>
