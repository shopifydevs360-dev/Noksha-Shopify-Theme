{% liquid
  assign main_classes = 'custom-section ' | append: 'section-id-' | append: section.id 
  assign main_classes = main_classes | append: ' ' | append: section.settings.container_width
  assign main_classes = main_classes | append: ' ' | append: ' m-color-' | append: section.settings.custom_section_color_scheme
  assign main_classes = main_classes | append: ' ' | append: section.settings.color_control
  assign main_classes = main_classes | append: ' ' | append: section.settings.custom_class

  if section.settings.background_type ==  'image'
    assign has_bg_image = false
    if section.settings.background_image != blank or section.settings.background_image_mobile != blank
      assign has_bg_image = true
    endif
  endif
  if section.settings.background_type ==  'color'
   if section.settings.background_style == 'solid'
     assign bg_color = section.settings.background_color
   elsif section.settings.background_style == 'gradient'
     assign bg_color = section.settings.background_gradient
   endif
    
  endif



  assign height_type = section.settings.height_type

  
  if section.settings.background_image != blank and height_type == "image"
    assign aspect_ratio = section.settings.background_image.aspect_ratio
  endif
  
  if section.settings.background_image_mobile != blank and height_type == "image"
    assign aspect_ratio_mobile = section.settings.background_image_mobile.aspect_ratio
  endif

  assign justify_content = section.settings.justify_content
  assign align_items = section.settings.horizontal_alignment

  
if section.settings.enable_sidebar_space
  assign inner_content_classes = 'inner-section-content'
  assign inner_content_classes = inner_content_classes | append: ' sidebar-space'
endif
%}
{% style %}
.section-id-{{ section.id }} .custom-section__inner {
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: {{ justify_content }};
  padding: {{ section.settings.padding_y }}px {{ section.settings.padding_x }}px;
}

{% unless has_bg_image %}
.section-id-{{ section.id }} .custom-section__inner {
  background: {{ bg_color }};
}
{% endunless %}

/* Height modes */
.section-id-{{ section.id }} .custom-section__inner[data-height="content"] {
  height: auto;
}

.section-id-{{ section.id }} .custom-section__inner[data-height="custom"] {
  height: {{ section.settings.height_desktop }}px;
}

/* Image aspect-ratio height */
{% if height_type == 'image' and aspect_ratio and has_bg_image %}
.section-id-{{ section.id }} .custom-section__inner[data-height="image"] {
  height: auto;
}

.section-id-{{ section.id }} .custom-section__inner[data-height="image"]::before {
  content: "";
  display: block;
  width: 100%;
  padding-top: calc(100% / {{ aspect_ratio }});
}

.section-id-{{ section.id }} .custom-section__inner[data-height="image"] > * {
  position: absolute;
  inset: 0;
}

.section-id-{{ section.id }} .custom-section__inner {
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: {{ justify_content }};
  align-items: {{ align_items }};
  padding: {{ section.settings.padding_y }}px {{ section.settings.padding_x }}px;
}


{% if aspect_ratio_mobile %}
@media (max-width: 768px) {
  .section-id-{{ section.id }} .custom-section__inner[data-height="image"]::before {
    padding-top: calc(100% / {{ aspect_ratio_mobile }});
  }
}
{% endif %}
{% endif %}

/* Responsive custom heights */
@media (max-width: 1024px) {
  .section-id-{{ section.id }} .custom-section__inner[data-height="custom"] {
    height: {{ section.settings.height_tablet }}px;
  }
}

@media (max-width: 768px) {
  .section-id-{{ section.id }} .custom-section__inner[data-height="custom"] {
    height: {{ section.settings.height_mobile }}px;
  }
}

/* Background image */
.section-id-{{ section.id }} .custom-section__background {
  position: absolute;
  inset: 0;
  z-index: -2;
}

.section-id-{{ section.id }} .custom-section__background img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Overlay */
{% if section.settings.overlay_enable %}
.section-id-{{ section.id }} .custom-section__overlay {
  position: absolute;
  inset: 0;
  background-color: {{ section.settings.overlay_color }};
  opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
  z-index: -1;
  pointer-events: none;
}
{% endif %}
{% endstyle %}

<div class="{{ main_classes }}">
  <div class="custom-section__inner" data-height="{{ height_type }}">
    {% if has_bg_image %}
      {% liquid
        assign bg_image = section.settings.background_image
      %}
      {% render 'image',
        class: 'custom-section__background',
        image: bg_image,
        width: bg_image.width,
        height: bg_image.height,
        mobile_image: section.settings.background_image_mobile,
        img_alt: bg_image.alt
      %}
    {% endif %}

    {% if section.settings.overlay_enable %}
      <div class="custom-section__overlay" aria-hidden="true"></div>
    {% endif %}


    <div class="custom-section__content">
      <div class="{{ inner_content_classes }}">
        {% content_for 'blocks' %}
      </div>
    </div>

  </div>
</div>



{% schema %}
{
  "name": "Custom section",
  "blocks": [{ "type": "@theme" }],
  "settings": [
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "container-fluid", "label": "Container fluid" },
        { "value": "container-narrow", "label": "Container narrow" },
        { "value": "container-extra-narrow", "label": "Container extra narrow" },
        { "value": "extended", "label": "Extended" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "container"
    },
    {
      "type": "checkbox",
      "id": "enable_sidebar_space",
      "label": "Enable sidebar space",
      "default": true
    },
    {
      "type": "select",
      "id": "height_type",
      "label": "Section height",
      "options": [
        { "value": "content", "label": "Adapt to content" },
        { "value": "image", "label": "Adapt to bg image" },
        { "value": "custom", "label": "Custom height" }
      ],
      "default": "content"
    },
    {
      "type": "range",
      "id": "height_desktop",
      "label": "Custom height (desktop)",
      "min": 200,
      "max": 2000,
      "step": 20,
      "unit": "px",
      "default": 800,
      "visible_if": "{{ section.settings.height_type ==  'custom' }}"
    },
    {
      "type": "range",
      "id": "height_tablet",
      "label": "Custom height (tablet)",
      "min": 200,
      "max": 1500,
      "step": 20,
      "unit": "px",
      "default": 600,
      "visible_if": "{{ section.settings.height_type ==  'custom' }}"
    },
    {
      "type": "range",
      "id": "height_mobile",
      "label": "Custom height (mobile)",
      "min": 200,
      "max": 1200,
      "step": 20,
      "unit": "px",
      "default": 500,
      "visible_if": "{{ section.settings.height_type ==  'custom' }}"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "Background",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "image", "label": "Image" },
        { "value": "color", "label": "Color" }
      ],
      "default": "none"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image (desktop)",
      "visible_if": "{{ section.settings.background_type ==  'image' }}"
    },
    {
      "type": "image_picker",
      "id": "background_image_mobile",
      "label": "Background image (mobile)",
      "visible_if": "{{ section.settings.background_type ==  'image' }}"
    },
    {
      "type": "checkbox",
      "id": "overlay_enable",
      "label": "Enable overlay",
      "default": false,
      "visible_if": "{{ section.settings.background_type ==  'image' }}"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000",
      "visible_if": "{{ section.settings.overlay_enable == true }}"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 40,
      "visible_if": "{{ section.settings.overlay_enable == true }}"
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background style",
      "options": [
        { "value": "solid", "label": "Solid color" },
        { "value": "gradient", "label": "Gradient" }
      ],
      "default": "solid",
      "visible_if": "{{ section.settings.background_type ==  'color' }}"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff",
      "visible_if": "{{ section.settings.background_style == 'solid' and section.settings.background_type == 'color' }}"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "Background gradient",
      "default": "linear-gradient(180deg, #ffffff, #000000)",
      "visible_if": "{{ section.settings.background_style == 'gradient' and section.settings.background_type == 'color' }}"
    },
    {
      "type": "header",
      "content": "Inner content color scheme"
    },
    {
      "type": "color_scheme",
      "id": "custom_section_color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "header",
      "content": "Inner padding & alignment"
    },
    {
      "type": "range",
      "id": "padding_y",
      "label": "Padding top/bottom",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_x",
      "label": "Padding left/right",
      "min": 0,
      "max": 200,
      "step": 5,
      "unit": "px",
      "default": 30,
      "visible_if": "{{ section.settings.container_width ==  'full-width' }}"
    },
    {
      "type": "select",
      "id": "justify_content",
      "label": "Content vertical alignment",
      "options": [
        { "value": "flex-start", "label": "Top" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Bottom" }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "horizontal_alignment",
      "label": "Horizontal alignment",
      "default": "center",
      "options": [
        { "value": "flex-start", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Right" }
      ]
    },
    {
      "type": "header",
      "content": "Dynamic Option"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "custom class"

    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "info": "Color control for sidebar [Learn more](https://codecraftmehedi.com/)", 
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    },
  ],
  "presets": [
    { "name": "Custom Section" }
  ]
}
{% endschema %}
