{{ 'collection-product-list.css' | asset_url | stylesheet_tag }}
{{ 'products-filter.css' | asset_url | stylesheet_tag }}

<div
  class="main-product-list m-color-{{ section.settings.product_color_scheme }} {{ section.settings.color_control }} {{ section.settings.custom_class }}"
  data-section-id="{{ section.id }}"
  data-enable-pagination="{{ section.settings.enable_pagination }}"
  data-pagination-type="{{ section.settings.pagination_type }}"
  data-products-per-page="{{ section.settings.products_per_page }}"
>

  <div class="{{ section.settings.container_type }}">
    <div class="collection-wrapper {% if section.settings.enable_filter %}with-sidebar{% endif %}">

      <main class="inner-warpper">
        <div class="product-list">
          
          <!-- Mobile Filter Toggle Button -->
          {% if section.settings.enable_filter %}
            <button type="button" class="mobile-filter-toggle" aria-label="Open filters">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M10 18H14V16H10V18ZM3 6V8H21V6H3ZM6 13H18V11H6V13Z" fill="currentColor"/>
              </svg>
            </button>
          {% endif %}

          <!-- Products -->
          {% paginate collection.products by section.settings.products_per_page %}
            <div
              class="products-grid cols-{{ section.settings.grid_columns_desktop }}"
              id="productsContainer"
              data-total-products="{{ collection.products_count }}"
              data-total-pages="{{ paginate.pages }}"
              data-current-page="{{ paginate.current_page }}"
            >
              {% for product in collection.products %}
                {% render 'product-card', product: product %}
              {% else %}
                <div class="empty-collection">
                  <p>No products found in this collection.</p>
                </div>
              {% endfor %}
            </div>
          {% endpaginate %}

        <!-- Pagination UI -->
        {% if section.settings.enable_pagination and paginate.pages > 1 %}
          <div id="paginationWrapper" class="custom-pagination">

            {% if section.settings.pagination_type == 'pagination_by_number' %}
              <nav class="pagination-ui pagination-ui--numbers">
                <div class="pagination-numbers" data-pagination-numbers>
                  {% if paginate.pages > 1 %}
                    {% for page in (1..paginate.pages) %}
                      <button
                        type="button"
                        data-page-number="{{ page }}"
                        class="{% if page == paginate.current_page %}active{% endif %}"
                        {% if page == paginate.current_page %}disabled{% endif %}
                      >
                        {{ page }}
                      </button>
                    {% endfor %}
                  {% endif %}
                </div>
              </nav>
            {% elsif section.settings.pagination_type == 'load_more_button' %}
              <div class="pagination-ui pagination-ui--loadmore">
                {% if paginate.next %}
                  <button type="button" id="loadMoreBtn" class="load-more-btn">
                    Load More
                  </button>
                {% endif %}
                <div class="pagination-loader" data-loader hidden>
                  Loading...
                </div>
              </div>
            {% elsif section.settings.pagination_type == 'infinity_loading' %}
              <div class="pagination-ui pagination-ui--infinity">
                <div class="pagination-loader" data-loader hidden>
                  Loading...
                </div>
              </div>
            {% endif %}

          </div>
        {% endif %}

        </div>

        <!-- Filters -->
        {% if section.settings.enable_filter %}
          <div class="filters-wrapper" id="filtersWrapper">
            <div class="filters-header">
              <h2>Filters</h2>
              <button type="button" class="filters-close-btn" aria-label="Close filters">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
            {% render 'product-filter', section: section, collection: collection %}
          </div>
        {% endif %}

      </main>

    </div>
  </div>
</div>

<script src="{{ 'product-filter.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Collection Product List",
  "class": "section-collection-product-list",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "container_type",
      "label": "Container Type",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "container-fluid", "label": "Container Fluid" },
        { "value": "container-narrow", "label": "Container Narrow" },
        { "value": "container-extra-narrow", "label": "Container Extra Narrow" },
        { "value": "full-width", "label": "Full Width"}
      ],
      "default": "container"
    },
    {
      "type": "color_scheme",
      "id": "product_color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Product Grid"
    },
    {
      "type": "range",
      "id": "grid_columns_desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "label": "Desktop Grid Columns",
      "default": 4
    },
    {
      "type": "header",
      "content": "Pagination"
    },
    {
      "type": "checkbox",
      "id": "enable_pagination",
      "label": "Enable Pagination",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 2,
      "max": 48,
      "step": 1,
      "label": "Products per page",
      "default": 24
    },
    {
      "type": "select",
      "id": "pagination_type",
      "label": "Pagination Type",
      "options": [
        { "value": "pagination_by_number", "label": "Pagination by Number" },
        { "value": "load_more_button", "label": "Load More Button" },
        { "value": "infinity_loading", "label": "Infinity Loading" }
      ],
      "default": "pagination_by_number"
    },
    {
      "type": "header",
      "content": "Sorting & Filter"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable Sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filter",
      "label": "Enable Filter",
      "default": true
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom class"
    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    }
  ],
  "blocks": [
    {
      "type": "availability-filter",
      "name": "Availability Filter",
      "limit": 1
    },
    {
      "type": "collection-filter",
      "name": "Collection Filter (Menu)",
      "limit": 1,
      "settings": [
        {
          "type": "link_list",
          "id": "collection_menu",
          "label": "Collection Menu"
        }
      ]
    },
    {
      "type": "vendor-filter",
      "name": "Vendor Filter",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Vendor"
        }
      ]
    },
    {
      "type": "color-filter",
      "name": "Color Filter",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Color"
        },
        {
          "type": "textarea",
          "id": "allow_colors",
          "label": "Custom Colors (Allow)",
          "info": "Comma separated values. If filled, only these colors will show."
        },
        {
          "type": "textarea",
          "id": "disallow_colors",
          "label": "Disallow Colors",
          "info": "Comma separated values. These colors will be hidden."
        }
      ]
    },
    {
      "type": "tag-filter",
      "name": "Tag Filter (Custom)",
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Tags"
        },
        {
          "type": "textarea",
          "id": "custom_filter_tags",
          "label": "Allowed Tags",
          "info": "Comma separated tags (example: Summer, Winter, New)."
        }
      ]
    },
    {
      "type": "price-filter",
      "name": "Price Filter",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Price"
        }
      ]
    },
    {
      "type": "product-type-filter",
      "name": "Product Type Filter",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Product Type"
        },
        {
          "type": "textarea",
          "id": "product_types",
          "label": "Product Types",
          "info": "Comma separated values (example: T-shirt, Hoodie, Pants)"
        }
      ]
    },
    {
      "type": "size-filter",
      "name": "Size Filter (Custom)",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "filter_title",
          "label": "Title",
          "default": "Size"
        },
        {
          "type": "textarea",
          "id": "sizes",
          "label": "Sizes",
          "info": "Comma separated values. If filled, only these sizes will show."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Product List",
      "blocks": [
        {
          "type": "availability-filter"
        },
        {
          "type": "vendor-filter"
        },
        {
          "type": "color-filter"
        },
        {
          "type": "price-filter"
        }
      ]
    }
  ]
}
{% endschema %}