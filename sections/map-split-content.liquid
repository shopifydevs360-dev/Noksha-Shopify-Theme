{% render 'section-base-style' %}

{% liquid
  assign ss = section.settings

  assign first_class = 'map-split-section ' | append: 'm-color-' | append: ss.color_scheme 
  assign first_class = first_class | append: ' ' | append: ss.color_control
  assign first_class = first_class | append: ' ' | append: ss.custom_class
  assign first_class = first_class | append: ' ' | append: 'section-' | append: section.id | append: '-padding'
  assign container_width = ss.container_width
%}

<div class="{{ first_class }}" id="map-split-{{ section.id }}">
  <div class="{{ container_width }}">

    <div class="map-split-wrapper d-flex flex-column flex-row-lg {% if ss.enable_sidebar_space %}sidebar-space{% endif %}">

      <!-- LEFT MAP -->
      <div class="map-area flex-grow">
        <div 
          id="map-{{ section.id }}" 
          class="leaflet-map"
          data-coordinates="{{ ss.coordinates }}"
          data-title="{{ ss.map_title }}"
        ></div>
      </div>

      <!-- RIGHT CONTENT -->
      <div class="content-area d-flex flex-column flex-grow">

        {% if ss.heading != blank %}
          <h2 class="{{ ss.heading_size }}">
            {{ ss.heading }}
          </h2>
        {% endif %}

        {% if ss.description != blank %}
          <div class="section-description">
            {{ ss.description }}
          </div>
        {% endif %}

        {% if ss.button_label != blank %}
          <a href="" class="get-direction" data-coordinates="{{ ss.coordinates }}" target="_blank" rel="noopener">
            <span class="text">{{ ss.button_label }}</span>
            <span class="icon">{%- render 'theme-icon', icon: 'arrow-direction' -%}</span>
          </a>
        {% endif %}

        <!-- IMAGE GRID -->
        <div class="image-grid d-flex">
          
          {% if ss.image_1 != blank %}
            <div class="grid-item flex-grow">
              {% render 'image',
                class: 'cropped-image-wrapper cropped-image--square',
                image: ss.image_1,
                img_alt: ss.heading,
                crop: 'center',
              %}
            </div>
          {% endif %}

          {% if ss.image_2 != blank %}
            <div class="grid-item flex-grow">
              {% render 'image',
                class: 'cropped-image-wrapper cropped-image--square',
                image: ss.image_2,
                img_alt: ss.heading,
                crop: 'center',
              %}
            </div>
          {% endif %}

        </div>

      </div>

    </div>

  </div>
</div>

{% stylesheet %}

/* Layout */
.map-split-section .map-split-wrapper {
  gap: 2rem;
}

@media (min-width: 992px) {
  .map-split-section .map-split-wrapper {
    display: flex;
  }

  .map-split-section .map-area,
  .map-split-section .content-area {
    max-width: 50%;
    height: 400px;
  }
}

.map-split-section .leaflet-map {
  width: 100%;
  height: 100%;
  min-height: 400px;
  z-index: 1;
}


/* Content */
.map-split-section .content-area h2 {
  margin-bottom: 20px;
}

.map-split-section .section-description {
  margin-bottom: 20px;
}

/* Button */
.map-split-section .get-direction {
  display: inline-flex;
  align-items: center;
  border-bottom: 2px solid rgb(var(--color-border));
  padding-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  gap: 0.4rem;
  margin-bottom: 1.5rem;
  width: fit-content;
}

.map-split-section .get-direction svg {
  width: 1.2rem;
}

/* Image Grid */
.map-split-section .image-grid {
  gap: 0;
  margin-top: auto;
  height: 100%;
}

.map-split-section .grid-item {
  overflow: hidden;
  height: 100%;
}

.map-split-section .grid-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Mobile */
@media (max-width: 991px) {

  .map-split-section .map-area,
  .map-split-section .content-area {
    height: auto;
  }

  .map-split-section .image-grid {
    height: auto;
  }

  .map-split-section .grid-item img {
    height: auto;
  }

}

{% endstylesheet %}

<script>
document.addEventListener("DOMContentLoaded", function () {

  const section = document.getElementById("map-split-{{ section.id }}");
  if (!section) return;

  const mapContainer = section.querySelector(".leaflet-map");
  if (!mapContainer) return;

  const directionBtn = section.querySelector(".get-direction");

  const coordString = mapContainer.dataset.coordinates;
  const title = mapContainer.dataset.title || '';

  if (!coordString) return;

  const parts = coordString.split(",");
  if (parts.length !== 2) return;

  const lat = parseFloat(parts[0].trim());
  const lng = parseFloat(parts[1].trim());

  if (isNaN(lat) || isNaN(lng)) return;

  if (mapContainer._leaflet_id) return;
  if (typeof L === "undefined") return;

  const map = L.map(mapContainer.id, {
    scrollWheelZoom: false
  }).setView([lat, lng], 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.marker([lat, lng])
    .addTo(map)
    .bindPopup(title)
    .openPopup();

  if (directionBtn) {
    directionBtn.href = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
  }

});
</script>





{% schema %}
{
  "name": "Map Split Content",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "enable_sidebar_space",
      "label": "Enable sidebar space",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "container-fluid", "label": "Container fluid" },
        { "value": "container-narrow", "label": "Container narrow" },
        { "value": "container-extra-narrow", "label": "Container extra narrow" },
        { "value": "full-width", "label": "Full width" },
        { "value": "extended", "label": "Extended" }
      ],
      "default": "extended"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Title",
      "default": "Visit Our Store"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading Size",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "h4", "label": "H4" }
      ],
      "default": "h2"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Richtext"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Get Directions"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image 2"
    },
    {
      "type": "text",
      "id": "coordinates",
      "label": "Map Coordinates",
      "default": "25.2854, 51.5310"
    },
    {
      "type": "text",
      "id": "map_title",
      "label": "Map Popup Title",
      "default": "Our Store Location"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 52
    },
    {
      "type": "header",
      "content": "Dynamic Option"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom class"
    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    }
  ],
  "presets": [
    {
      "name": "Map Split Content"
    }
  ]
}
{% endschema %}
