

{% render 'section-base-style' %}
{% liquid
  assign ss = section.settings

  assign first_class = 'map-split-section ' | append: 'm-color-' | append: ss.color_scheme 
  assign first_class = first_class | append: ' ' | append: ss.color_control
  assign first_class = first_class | append: ' ' | append: ss.custom_class
  assign first_class = first_class | append: ' ' | append: 'section-' | append: section.id | append: '-padding'
  assign container_width = ss.container_width
%}

<div class="{{ first_class }}" id="map-split-{{ section.id }}">
  <div class="{{ container_width }}">

    <div class="map-split-wrapper">

      <!-- LEFT MAP -->
      <div class="map-area">
        <div 
          id="map-{{ section.id }}" 
          class="leaflet-map"
          data-coordinates="{{ ss.coordinates }}"
          data-title="{{ ss.map_title }}"
        ></div>
      </div>

      <!-- RIGHT CONTENT -->
      <div class="content-area">

        {% if ss.heading != blank %}
          <h2 class="{{ ss.heading_size }}">
            {{ ss.heading }}
          </h2>
        {% endif %}

        {% if ss.description != blank %}
          <div class="section-description">
            {{ ss.description }}
          </div>
        {% endif %}

        {% if ss.button_label != blank %}
          <a 
            href="{{ ss.button_link }}" 
            class="btn-primary"
          >
            {{ ss.button_label }}
          </a>
        {% endif %}

        <div class="image-grid">
          {% if ss.image_1 != blank %}
            <div class="grid-item">
              {% render 'image',
                class: '{{ ss.image_1 }}',
                image: ss.image_1,
                width: {{ image.width }},
                height: {{ image.height }},
                img_alt: ss.heading
              %}
            </div>
          {% endif %}

          {% if ss.image_2 != blank %}
            <div class="grid-item">
              {% render 'image',
                class: '{{ ss.image_2 }}',
                image: ss.image_2,
                width: {{ image.width }},
                height: {{ image.height }},
                img_alt: ss.heading
              %}
            </div>
          {% endif %}
        </div>

      </div>

    </div>

  </div>
</div>


{% stylesheet %}

.map-split-section .map-split-wrapper {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
  align-items: stretch;
}

.map-split-section .map-area {
  min-height: 500px;
}

.map-split-section .leaflet-map {
  width: 100%;
  height: 100%;
  min-height: 500px;
  border-radius: 6px;
  z-index: 1;
}

.map-split-section .content-area h2 {
  margin-bottom: 20px;
}

.map-split-section .section-description {
  margin-bottom: 20px;
}

.map-split-section .image-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 30px;
}

.map-split-section .image-grid img {
  width: 100%;
  display: block;
  border-radius: 6px;
}

/* Responsive */
@media (max-width: 991px) {
  .map-split-section .map-split-wrapper {
    grid-template-columns: 1fr;
  }

  .map-split-section .map-area {
    min-height: 400px;
  }
}

{% endstylesheet %}


<script>
document.addEventListener("DOMContentLoaded", function () {

  const section = document.getElementById("map-split-{{ section.id }}");
  if (!section) return;

  const mapContainer = section.querySelector(".leaflet-map");
  if (!mapContainer) return;

  const coordString = mapContainer.dataset.coordinates;
  const title = mapContainer.dataset.title;

  if (!coordString) return;

  const parts = coordString.split(",");
  if (parts.length !== 2) return;

  const lat = parseFloat(parts[0].trim());
  const lng = parseFloat(parts[1].trim());

  if (isNaN(lat) || isNaN(lng)) return;

  const map = L.map(mapContainer.id).setView([lat, lng], 14);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.marker([lat, lng]).addTo(map).bindPopup(title).openPopup();

});
</script>


{% schema %}
{
  "name": "Map Split Content",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Title",
      "default": "Visit Our Store"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading Size",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "h4", "label": "H4" }
      ],
      "default": "h2"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Richtext"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Get Directions"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image 2"
    },
    {
      "type": "text",
      "id": "coordinates",
      "label": "Map Coordinates",
      "default": "25.2854, 51.5310"
    },
    {
      "type": "text",
      "id": "map_title",
      "label": "Map Popup Title",
      "default": "Our Store Location"
    },

    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container width",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "extended", "label": "Extended" }
      ],
      "default": "container"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text Align",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 52
    },
    {
      "type": "header",
      "content": "Dynamic Option"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom class"
    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    }
  ],
  "presets": [
    {
      "name": "Map Split Content"
    }
  ]
}
{% endschema %}
