{% comment %}
  This section is used in the search template to render search results for
  products, articles, and pages.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/search
{% endcomment %}
<div class="search-product-list m-color-{{ section.settings.product_color_scheme }} {{ section.settings.color_control }} {{ section.settings.custom_class }}">
  <div class="{{ section.settings.container_type }}">

    <!-- Header -->
    <div class="search-header sidebar-space"> 
      <h1 class="search-title">{{ 'search.title' | t }}</h1>
    </div>

    <!-- Search Form -->
    <div class="search-form sidebar-space"> 
      <form action="{{ routes.search_url }}" method="get" role="search">
        <input
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="{{ 'search.placeholder' | t }}"
        >
        <button type="submit">{{ 'search.submit' | t }}</button>
      </form>
    </div>

    <!-- Results -->
    <div class="collection-wrapper sidebar-space">
      <main class="inner-warpper">
        <div class="product-list">

          {% if search.performed %}

            {% paginate search.results by 20 %}

              {% assign product_results = search.results | where: "object_type", "product" %}

              {% if product_results.size > 0 %}
                <div class="products-grid cols-{{ section.settings.grid_columns }}{% if section.settings.show_two_mobile %} cols-mobile-2{% endif %}">
                  {% for result in product_results %}
                    {% render 'product-card', product: result %}
                  {% endfor %}
                </div>

                {{ paginate | default_pagination }}

              {% else %}
                <div class="collection-empty-state">
                  <p>{{ 'search.no_results_html' | t: terms: search.terms }}</p>
                </div>
              {% endif %}

            {% endpaginate %}

          {% endif %}

        </div>
      </main>
    </div>

  </div>
</div>


<form action="{{ routes.search_url }}" method="get" role="search">
  <input
    type="search"
    size="50"
    name="q"
    value="{{ search.terms | escape }}"
    placeholder="{{ 'search.placeholder' | t }}"
  >
  <button type="submit">{{ 'search.submit' | t }}</button>
</form>

{% if search.performed %}
  {% if search.results_count == 0 %}
    <p>{{ 'search.no_results_html' | t: terms: search.terms }}</p>
  {% else %}
    <p>{{ 'search.results_for_html' | t: terms: search.terms, count: search.results_count }}</p>

    <div class="search-results">
      {% paginate search.results by 20 %}
        {% # Search result items may be an article, a page, or a product. %}
        {% for result in search.results %}
          <div class="search-result">
            {% assign featured_image = result.featured_image | default: result.image %}
            {% if featured_image %}
              {% render 'image', class: 'search-result__image', image: featured_image, url: result.url, width: 400 %}
            {% endif %}
            <div class="search-result__content">
              <p>
                {{ result.title | link_to: result.url }}
                {% if result.price %}
                  {{ result.price | money_with_currency }}
                {% endif %}
              </p>
            </div>
          </div>
        {% endfor %}

        {{ paginate | default_pagination }}
      {% endpaginate %}
    </div>
  {% endif %}
{% endif %}

{% stylesheet %}

{% endstylesheet %}

{% schema %}
{
  "name": "t:general.search",
  "settings": [
        {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "container_type",
      "label": "Container Type",
      "options": [
        { "value": "container", "label": "Container" },
        { "value": "container-fluid", "label": "Container Fluid" },
        { "value": "container-narrow", "label": "Container Narrow" },
        { "value": "container-extra-narrow", "label": "Container Extra Narrow" },
        { "value": "extended", "label": "Extended" }
      ],
      "default": "container"
    },
    {
      "type": "color_scheme",
      "id": "product_color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Product Grid"
    },
    {
      "type": "select",
      "id": "grid_columns",
      "label": "Grid Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" },
        { "value": "6", "label": "6" }
      ],
      "default": "4"
    },
    {
      "type": "checkbox",
      "id": "show_two_mobile",
      "label": "Show 2 col mobile",
      "info": "You can show 2 column in a mobile",
      "default": false
    },
    {
      "type": "header",
      "content": "Pagination"
    },
    {
      "type": "checkbox",
      "id": "enable_pagination",
      "label": "Enable Pagination",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 2,
      "max": 48,
      "step": 1,
      "label": "Products per page",
      "default": 24
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom class"
    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    }
  ]
}
{% endschema %}
