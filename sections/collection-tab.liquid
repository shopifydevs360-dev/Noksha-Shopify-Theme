{% comment %} {{ 'collection-tab.css' | asset_url | stylesheet_tag }} {% endcomment %}
{% render 'section-base-style' %}
<div class="product-tabs-carousel js-product-carousel-{{ section.id }} {{ section.settings.color_control }} {{ section.settings.custom_class }} m-color-{{ section.settings.color_scheme }}">
  <div class="product-carousel section-{{ section.id }}-padding">
    <!-- ================= MOBILE TITLE ================= -->
    <h2 class="container hide-desktop hide-large-screens {{ section.settings.title_font_size }}">
      <a class="{{ section.settings.title_font_size }}" href="{{ section.settings.title_link }}" aria-label="{{ section.settings.title }}">
        <div data-reveal="lines-masked" class="info-title">
          {{ section.settings.title }}
        </div>
      </a>
    </h2>

    <!-- ================= FILTER TABS ================= -->
    <div class="swiper swiper-container-filter">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          {% assign handle = block.settings.collection.handle %}
          <div class="related-product-caps swiper-slide {% if forloop.first %}active{% endif %}">
            <a
              href="#"
              class="js-slider-filter"
              data-filter="{{ handle }}"
              aria-label="{{ block.settings.tab_label }}"
            >
              {{ block.settings.tab_label }}
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
    <!-- ================= PRODUCTS CAROUSEL ================= -->
    <div class="swiper swiper-container-product">
      <div class="swiper-wrapper">

        <!-- Desktop Lead Card -->
        <div class="swiper-slide v-aligner hide-tablet hide-mobile hide-tablet-landscape">
          <div class="collection-lead-info">
            <h2 class="{{ section.settings.title_font_size }}">
              <a class="{{ section.settings.title_font_size }}" href="{{ section.settings.title_link }}">
                <div data-reveal="lines-masked" class="info-title">
                  {{ section.settings.title }}
                </div>
              </a>
            </h2>
            <a
              href="#"
              class="btn btn-arrow js-shop-now-btn"
            >
              SHOP NOW
              <span class="icon">
                {% render 'theme-icon', icon: 'right-arrow' %}
              </span>
            </a>

          </div>
        </div>

        <!-- Products -->
        {% for block in section.blocks %}
          {% assign collection = collections[block.settings.collection.handle] %}

            {% if collection and collection.products != blank %}
            {% for product in collection.products limit: 6 %}
              <div
                class="swiper-slide product-slide"
                data-collection="{{ collection.handle }}"
                {% unless forloop.parentloop.first %}hidden{% endunless %}
              >
                {% render 'product-card', product: product %}
              </div>
            {% endfor %}
          {% else %}
            <p>Please select a collection</p>
          {% endif %}
        {% endfor %}

      </div>

      <div class="swiper-scrollbar hide-desktop hide-large-screens"></div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.js-product-carousel-{{ section.id }}');
  if (!section) return;

  const tabs = section.querySelectorAll('.js-slider-filter');
  const slides = section.querySelectorAll('.product-slide');
  const shopNowBtn = section.querySelector('.js-shop-now-btn');

  /* ---------------- FILTER TABS SWIPER ---------------- */
  new Swiper(section.querySelector('.swiper-container-filter'), {
    slidesPerView: 'auto',
    freeMode: true,
    spaceBetween: 40
  });

  /* ---------------- PRODUCTS SWIPER ---------------- */
  const productSwiper = new Swiper(section.querySelector('.swiper-container-product'), {
    slidesPerView: 1.2,
    scrollbar: {
      el: section.querySelector('.swiper-scrollbar'),
      draggable: true
    },
    breakpoints: {
      580: { slidesPerView: 2.5 },
      991: { slidesPerView: 3 },
      1321: { slidesPerView: 3.5 }
    },
    on: {
      slideChangeTransitionEnd() {
        animateVisibleCards();
      }
    }
  });

  /* ---------------- ANIMATION HANDLER ---------------- */
  function animateVisibleCards() {
    // Remove animation from all cards
    section.querySelectorAll('.product-card').forEach(card => {
      card.classList.remove('is-animated');
    });

    // Force reflow
    void section.offsetHeight;

    // Animate only visible cards
    section.querySelectorAll(
      '.product-slide[style*="display: block"] .product-card'
    ).forEach(card => {
      card.classList.add('is-animated');
    });
  }

  /* ---------------- ASSIGN VISIBLE INDEX ---------------- */
  function updateVisibleIndexes() {
    const visibleSlides = Array.from(slides).filter(
      slide => slide.style.display === 'block'
    );

    visibleSlides.forEach((slide, index) => {
      slide.setAttribute('item-index', index + 1);
    });
  }

  /* ---------------- TAB ACTIVATION ---------------- */
  function activateTab(filter, tab) {
    // Active tab UI
    section.querySelectorAll('.related-product-caps')
      .forEach(el => el.classList.remove('active'));
    tab.closest('.related-product-caps').classList.add('active');

    // Hide all slides
    slides.forEach(slide => {
      slide.style.display = 'none';
      slide.removeAttribute('item-index');
      slide.querySelectorAll('.product-card').forEach(card => {
        card.classList.remove('is-animated');
      });
    });

    // Show selected slides
    slides.forEach(slide => {
      if (slide.dataset.collection === filter) {
        slide.style.display = 'block';
      }
    });

    // Assign fresh indexes ONLY to visible slides
    updateVisibleIndexes();

    // Update Shop Now button
    if (shopNowBtn) {
      shopNowBtn.href = `/collections/${filter}`;
    }

    // Reset swiper
    productSwiper.update();
    productSwiper.slideTo(0, 0);

    // Animate visible cards
    animateVisibleCards();
  }

  /* ---------------- INIT FIRST TAB ---------------- */
  if (tabs.length) {
    activateTab(tabs[0].dataset.filter, tabs[0]);
  }

  /* ---------------- TAB CLICK EVENTS ---------------- */
  tabs.forEach(tab => {
    tab.addEventListener('click', e => {
      e.preventDefault();
      activateTab(tab.dataset.filter, tab);
    });
  });
});
</script>


{% stylesheet %}
  .product-tabs-carousel .swiper-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    z-index: 1;
    display: flex;
    transition-property: transform;
    box-sizing: content-box;
}
.product-tabs-carousel .product-carousel .swiper-container-filter {
    width: calc(100% - 1.2rem);
    padding-top: 1.2rem;
    margin-left: 1.2rem;
    margin-right: 1.2rem;
}
@media (min-width: 991px) {
 .product-tabs-carousel .product-carousel .swiper-container-filter {
    width: calc(100% - 30rem);
    margin-left: 30rem;
    margin-right: 0;
  }
}

.product-tabs-carousel .swiper-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    z-index: 1;
    display: flex;
    transition-property: transform;
    box-sizing: content-box;
}
.product-tabs-carousel .product-carousel .swiper-container-filter {
    margin-bottom: 2rem;
}
.product-tabs-carousel .product-carousel .swiper-container-filter .swiper-slide {
    display: inline-block;
    width: auto;
}
.product-tabs-carousel .product-carousel .swiper-container-filter .swiper-slide a{
      position: relative;
}
.product-tabs-carousel .product-carousel .swiper-container-filter .swiper-slide a:after {
    content: "";
    background:#e3c7bf;
    position: absolute;
    height: 0.8px;
    width: 100%;
    bottom: -3px;
    left: 0;
}
.product-tabs-carousel .related-product-caps a{
    letter-spacing: .02rem;
    font-size: 1.3rem;
    line-height: 1.53846;
    font-weight: 300;
    text-transform: uppercase;
}
.product-tabs-carousel .product-carousel .swiper-slide {
    height: auto;
    padding: 0 0.5rem;
}
.product-tabs-carousel .product-carousel .swiper-container-product {
    padding-left: 1.2rem;
    padding-right: 1.2rem;
    padding-bottom: 1.4rem;
}
@media (min-width: 991px) {
 .product-tabs-carousel .product-carousel .swiper-container-product {
      padding-left: 8rem;
      padding-right: 4rem;
  }
}
.product-tabs-carousel .swiper-container-free-mode>.swiper-wrapper {
    transition-timing-function: ease-out;
    margin: 0 auto;
}
.product-tabs-carousel .v-aligner{
    display: flex;
    align-items: center;
}
.product-tabs-carousel .product-carousel .collection-lead-info {
    width: 88%;
    margin-left: auto;
}
.product-tabs-carousel .product-carousel .collection-lead-info {
    padding-bottom: 5rem;
}
.product-tabs-carousel .product-carousel .collection-lead-info h2 {
    margin-bottom: 3.2rem;
}


.product-tabs-carousel .product-carousel .collection-lead-info .btn.btn-arrow {
    font-size: 22px;
    padding: 0;
}
.product-tabs-carousel .product-carousel .collection-lead-info .btn-arrow .icon {
    margin-bottom: -4px;
    margin-left: 30px;
}
/* Product Card Style */
.product-tabs-carousel .product-carousel .product-card {
  opacity: 0;
  transform: translateX(4rem);
  transition: opacity 0.6s cubic-bezier(0.72, 0, 0.28, 1),
    transform 1.5s cubic-bezier(0, 0, 0.002, 1);
}
.product-tabs-carousel .product-carousel .swiper-slide:first-child {
    max-width: 22rem;
}
.product-tabs-carousel .product-carousel .product-card.is-animated {
  opacity: 1;
  transform: translate3d(0, 0, 0);
}
/* first few get stagger */

.product-tabs-carousel .product-carousel .product-slide[item-index="1"] .product-card.is-animated { transition-delay: 0.02s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="3"] .product-card.is-animated { transition-delay: 0.2s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="2"] .product-card.is-animated { transition-delay: 0.1s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="4"] .product-card.is-animated { transition-delay: 0.3s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="5"] .product-card.is-animated { transition-delay: 0.4s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="6"] .product-card.is-animated { transition-delay: 0.5s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="7"] .product-card.is-animated { transition-delay: 0.6s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="8"] .product-card.is-animated { transition-delay: 0.7s; }
.product-tabs-carousel .product-carousel .product-slide[item-index="9"] .product-card.is-animated { transition-delay: 0.8s; }

/* Slider Css */
.swiper-slide.product-slide{
    display: none;
}

/* Scrollbar style */
:root{
  --swiper-scrollbar-sides-offset: 4%;
}

{% endstylesheet %}

{% schema %}
{
  "name": "Collection Tabs Carousel",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Best Sellers"
    },
    {
      "type": "select",
      "id": "title_font_size",
      "label": "Font size",
      "options": [
        { "value": "h1", "label": "h1" },
        { "value": "h2", "label": "h2" },
        { "value": "h3", "label": "h3" },
        { "value": "h4", "label": "h4" },
      ],
      "default": "h3"
    },
    {
      "type": "url",
      "id": "title_link",
      "label": "Title Link"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 52
    },
        {
      "type": "header",
      "content": "Dynamic Option"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "custom class"
    },
    {
      "type": "select",
      "id": "color_control",
      "label": "Color Control",
      "info": "Color control for sidebar [Learn more](https://codecraftmehedi.com/)",      
      "options": [
        { "value": "section-dark", "label": "Dark" },
        { "value": "section-light", "label": "Light" }
      ],
      "default": "section-light"
    },
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Collection Tabs Carousel",
      "category": "Products"
    }
  ]
}
{% endschema %}
